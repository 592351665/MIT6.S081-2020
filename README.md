## 1.Large files

目的：通过混合索引机制添加二级索引页表，增大文件大小

文件系统中，磁盘和内存中数据结构为 dinode\inode；inode中存储的为数据所在盘块地址，前12个盘块数据可直接查询到，称为 直接记录盘块（每个盘块1024字节）；其余存放在一级索引盘中，1024/4=256；能存放268个盘块地址，文件共268KB大小；

修改后：11+256+256*256；

1.bmap:

bp = bread(ip->dev, addr);返回索引盘在缓冲区缓存（双向链表）中的缓存块，缓存块中的data即为一级索引盘块的地址内容（256个）；

log_write(bp)的作用？将修改后的间接块写入日志，确保崩溃恢复时的一致性

2.itrunc:两重释放；

## 2.Symbolic links

1.硬链接是文件系统中多个目录项指向同一个 inode 的引用；

软连接：

1）符号链接是一个特殊的文件，其内容是目标路径。

2）它类似于 Windows 中的快捷方式，指向目标文件或目录的路径。

3）符号链接可以跨文件系统，因为它只是存储了目标路径，而不是直接引用数据块。

sys_symlink:

1.target:目标路径，path:软连接文件本身路径；

2.create创建并返回了软连接文件的inode，使用完后要 解锁并释放iunlockput（ip）

3.writei将target路径写入inode第一个直接盘

第二参数：所写入数据来自用户态还是内核态（0）;

第三参数：数据地址；在 C 语言里，数组名在大多数表达式中会隐式转换为指向数组首元素的指针，也就是一个地址；

然后要将path指针转换成uint64类型。

第四参数：在文件内的偏移，0说明从头开始写；

sys_open：

usertrap-syscall-sys_open

使其在遇到符号链接的时候，可以递归跟随符号链接，直到跟随到非符号链接的 inode 为止；

通过readi递归把inode中的路径读到path中；
